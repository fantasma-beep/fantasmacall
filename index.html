<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FantasmaCall</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #202124;
            color: #E8EAED;
        }
        .control-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 80px;
            height: 60px;
            border-radius: 12px;
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
        }
        .control-button:hover {
            background-color: #3c4043;
        }
        .control-button.active {
            background-color: #4A4A4A;
        }
         .control-button.end-call {
            background-color: #EA4335;
        }
        .control-button.end-call:hover {
            background-color: #D93025;
        }
        .video-container {
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            background-color: #2D2E30;
        }
        .video-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .participant-name {
            position: absolute;
            bottom: 8px;
            left: 8px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 14px;
        }
    </style>
</head>
<body class="flex items-center justify-center h-screen">

    <!-- Pantalla de Bienvenida -->
    <div id="welcome-screen" class="text-center">
        <h1 class="text-4xl font-bold mb-4">Bienvenido a FantasmaCall</h1>
        <p class="text-lg text-gray-300 mb-8">Ingresa tu nombre para unirte a la reunión.</p>
        <div class="flex justify-center">
            <input type="text" id="username" placeholder="Tu nombre..." class="w-64 px-4 py-2 rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button id="join-btn" class="ml-4 px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition">Unirse</button>
        </div>
    </div>

    <!-- Pantalla de la Llamada -->
    <div id="call-screen" class="hidden w-full h-full flex flex-col">
        <!-- Área de video principal -->
        <main class="flex-1 p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="video-grid">
            <!-- Los videos de los participantes se agregarán aquí -->
        </main>
        
        <!-- Barra de Controles -->
        <footer class="w-full bg-black bg-opacity-30 p-4">
            <div class="max-w-4xl mx-auto flex justify-center items-center space-x-4">
                <div id="mute-btn" class="control-button">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg>
                    <span class="text-xs mt-1">Silenciar</span>
                </div>
                <div id="video-btn" class="control-button">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                    <span class="text-xs mt-1">Video</span>
                </div>
                <div id="end-call-btn" class="control-button end-call">
                     <svg class="w-6 h-6" fill="white" viewBox="0 0 24 24"><path d="M3.5 6.5C3.5 5.94772 3.94772 5.5 4.5 5.5H7.52503C7.99416 5.5 8.41164 5.75015 8.6521 6.16209L10.0521 8.56209C10.273 8.93791 10.273 9.41209 10.0521 9.78791L8.6521 12.1879C8.41164 12.6 7.99416 12.85 7.52503 12.85H5.5C4.94772 12.85 4.5 12.4023 4.5 11.85V6.5H3.5ZM3.5 6.5C2.94772 6.5 2.5 6.94772 2.5 7.5V11.85C2.5 13.5023 3.84772 14.85 5.5 14.85H7.52503C8.77534 14.85 9.87116 14.03 10.3521 12.8879L11.7521 10.4879C12.3129 9.45609 12.3129 8.20391 11.7521 7.16209L10.3521 4.76209C9.87116 3.62 8.77534 2.85 7.52503 2.85H4.5C3.5056 2.85 2.62233 3.41121 2.21948 4.28816L1.61625 5.5786C1.53696 5.74833 1.5 5.93581 1.5 6.1293V17.8707C1.5 18.0642 1.53696 18.2517 1.61625 18.4214L2.21948 19.7118C2.62233 20.5888 3.5056 21.15 4.5 21.15H20.5C21.3284 21.15 22 20.4784 22 19.65V18.5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                    <span class="text-xs mt-1">Salir</span>
                </div>
            </div>
        </footer>
    </div>

    <script>
        const welcomeScreen = document.getElementById('welcome-screen');
        const callScreen = document.getElementById('call-screen');
        const joinBtn = document.getElementById('join-btn');
        const usernameInput = document.getElementById('username');
        const videoGrid = document.getElementById('video-grid');
        const muteBtn = document.getElementById('mute-btn');
        const videoBtn = document.getElementById('video-btn');
        const endCallBtn = document.getElementById('end-call-btn');
        let localStream;
        let isMuted = false;
        let isVideoOff = false;

        const createVideoContainer = (id, name) => {
            const container = document.createElement('div');
            container.className = 'video-container aspect-video';
            const video = document.createElement('video');
            video.autoplay = true;
            video.playsInline = true;
            container.appendChild(video);
            const nameTag = document.createElement('div');
            nameTag.className = 'participant-name';
            nameTag.textContent = name;
            container.appendChild(nameTag);
            return { container, video };
        };

        joinBtn.addEventListener('click', async () => {
            if (usernameInput.value.trim() === '') {
                alert('Por favor, ingresa tu nombre.');
                return;
            }
            welcomeScreen.classList.add('hidden');
            callScreen.classList.remove('hidden');
            try {
                localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                const { container, video } = createVideoContainer('local', `${usernameInput.value} (Tú)`);
                video.srcObject = localStream;
                video.muted = true;
                videoGrid.appendChild(container);
            } catch (error) {
                console.error("Error accessing media devices.", error);
                alert("No se pudo acceder a tu cámara/micrófono. Revisa los permisos.");
            }
        });

        muteBtn.addEventListener('click', () => {
            isMuted = !isMuted;
            localStream.getAudioTracks()[0].enabled = !isMuted;
            muteBtn.classList.toggle('active', isMuted);
        });

        videoBtn.addEventListener('click', () => {
            isVideoOff = !isVideoOff;
            localStream.getVideoTracks()[0].enabled = !isVideoOff;
            videoBtn.classList.toggle('active', isVideoOff);
        });

        endCallBtn.addEventListener('click', () => {
            localStream.getTracks().forEach(track => track.stop());
            callScreen.classList.add('hidden');
            welcomeScreen.classList.remove('hidden');
            videoGrid.innerHTML = '';
        });
    </script>
</body>
</html>
